/* Magister.js (browser version) by simplyApps. Built on: 18-10-2016 15:29 UTC */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,s,t=function(a,b){return function(){return a.apply(b,arguments)}},u=[].slice;if(b=null!=(e="undefined"!=typeof module&&null!==module?module.exports:void 0)?e:null!=this.Magister?this.Magister:this.Magister={},b.Appointment=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.begin=b._getset("_begin"),this.end=b._getset("_end"),this.beginBySchoolHour=b._getset("_beginBySchoolHour"),this.endBySchoolHour=b._getset("_endBySchoolHour"),this.fullDay=b._getset("_fullDay"),this.description=b._getset("_description"),this.location=b._getset("_location"),this.status=b._getset("_status"),this.type=b._getset("_type"),this.typeString=b._getset("_type",null,function(a){switch(a){case 0:return"none";case 1:return"personal";case 2:return"general";case 3:return"schoolwide";case 4:return"internship";case 5:return"intake";case 6:return"scheduleFree";case 7:return"kwt";case 8:return"standby";case 9:return"block";case 10:return"miscellaneous";case 11:return"localBlock";case 12:return"classBlock";case 13:return"lesson";case 14:return"studiehuis";case 15:return"scheduleFreeStudy";case 16:return"planning";case 101:return"actions";case 102:return"presences";case 103:return"examSchedule";default:return"unknown"}}),this.displayType=b._getset("_displayType"),this.displayTypeString=b._getset("_displayType",null,function(a){switch(a){case 1:return"available";case 2:return"provisionallyScheduled";case 3:return"scheduled";case 4:return"absent";default:return"unknown"}}),this.content=b._getset("_content",null,b._helpers.cleanHtmlContent),this.infoType=b._getset("_infoType"),this.infoTypeString=b._getset("_infoType",null,function(a){switch(a){case 0:return"none";case 1:return"homework";case 2:return"test";case 3:return"exam";case 4:return"quiz";case 5:return"oral";case 6:return"information";case 7:return"annotation";default:return"unknown"}}),this.notes=b._getset("_notes"),this.isDone=b._getset("_isDone",function(a){return function(b){if(a._isDone!==b)return a._isDone=b,a._magisterObj.http.put(a.url(),a._toMagisterStyle(),{},function(){})}}(this)),this.classes=b._getset("_classes"),this.teachers=b._getset("_teachers"),this.classRooms=b._getset("_classRooms"),this.groups=b._getset("_groups"),this.appointmentId=b._getset("_appointmentId"),this.url=b._getset("_url"),this.scrapped=b._getset("_scrapped"),this.changed=b._getset("_changed"),this.absenceInfo=b._getset("_absenceInfo")}return a.prototype.attachments=function(a){return this._hasAttachments?void this._magisterObj.http.get(this._url,{},function(c){return function(d,e){var f,g;return null!=d?a(d,null):(f=JSON.parse(e.content).Bijlagen,g=c._teachers[0],a(null,f.map(function(a){return a._addedBy=g,b.File._convertRaw(c._magisterObj,void 0,a)})))}}(this)):void a(null,[])},a.prototype.remove=function(a){var b;if(1===(b=this._type)||16===b)return this._magisterObj.http.delete(this._url,{},function(b,c){return a(b)})},a.prototype._toMagisterStyle=function(){var a,c,d;return c={},c.Id=this._id,c.Start=b._helpers.toUtcString(this._begin),c.Einde=b._helpers.toUtcString(this._end),c.LesuurVan=this._beginBySchoolHour,c.LesuurTotMet=this._endBySchoolHour,c.DuurtHeleDag=this._fullDay,c.Omschrijving=this._description,c.Lokatie=this._location,c.Status=this._status,c.Type=this._type,c.WeergaveType=this._displayType,c.Inhoud=this._content,c.InfoType=this._infoType,c.Aantekening=this._notes,c.Afgerond=this._isDone,c.Lokalen=function(){var b,c,d,e;for(d=this._classRooms,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push({Naam:a});return e}.call(this),c.Docenten=function(){var a,b,c,e;for(c=this._teachers,e=[],a=0,b=c.length;a<b;a++)d=c[a],e.push(d._toMagisterStyle());return e}.call(this),c.Vakken=function(){var b,c,d,e;for(d=this._classes,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push({Naam:a});return e}.call(this),c.Groepen=this._groups,c.OpdrachtId=this._appointmentId,c.Bijlagen=[],c},a._convertRaw=function(a,c){var d,e,f,g,h,i,j;return e=new b.Appointment(a),e._id=c.Id,e._begin=b._helpers.parseDate(c.Start),e._end=b._helpers.parseDate(c.Einde),e._beginBySchoolHour=c.LesuurVan,e._endBySchoolHour=c.LesuurTotMet,e._fullDay=c.DuurtHeleDag,e._description=null!=(g=c.Omschrijving)?g:"",e._location=null!=(h=c.Lokatie)?h:"",e._status=c.Status,e._type=c.Type,e._displayType=c.WeergaveType,e._content=c.Inhoud,e._infoType=c.InfoType,e._notes=c.Aantekening,e._isDone=c.Afgerond,e._classes=null!=c.Vakken?function(){var a,b,e,f;for(e=c.Vakken,f=[],a=0,b=e.length;a<b;a++)d=e[a],f.push(d.Naam);return f}():[],e._teachers=null!=c.Docenten?function(){var d,e,g,h;for(g=c.Docenten,h=[],d=0,e=g.length;d<e;d++)f=g[d],h.push(b.Person._convertRaw(a,f));return h}():[],e._classRooms=null!=c.Lokalen?function(){var a,b,e,f;for(e=c.Lokalen,f=[],a=0,b=e.length;a<b;a++)d=e[a],f.push(d.Naam);return f}():[],e._groups=c.Groepen,e._appointmentId=c.OpdrachtId,e._hasAttachments=c.HeeftBijlagen,e._url=""+a._personUrl+"/afspraken/"+e._id,e._scrapped=4===(i=c.Status)||5===i,e._changed=3===(j=c.Status)||9===j||10===j,e},a._convertStored=function(a,d){var e;return e=c.extend(d,new b.Appointment(a)),e._magisterObj=a,e._begin=b._helpers.parseDate(d._begin),e._end=b._helpers.parseDate(d._end),e},a}(),b.AbsenceInfo=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.begin=b._getset("_begin"),this.end=b._getset("_end"),this.schoolHour=b._getset("_schoolHour"),this.permitted=b._getset("_permitted"),this.description=b._getset("_description"),this.type=b._getset("_type"),this.typeString=b._getset("_type",null,function(a){switch(a){case 1:return"absent";case 2:return"late";case 3:return"sick";case 4:return"discharged";case 6:return"exemption";case 7:return"books";case 8:return"homework";default:return"unknown"}}),this.code=b._getset("_code"),this.appointment=b._getset("_appointment")}return a._convertRaw=function(a,c){var d,e,f,g;return d=new b.AbsenceInfo(a),d._id=c.Id,d._begin=b._helpers.parseDate(c.Start),d._end=b._helpers.parseDate(c.Eind),d._schoolHour=c.Lesuur,d._permitted=c.Geoorloofd,d._description=null!=(e=null!=(f=c.Omschrijving)?f.trim():void 0)?e:"",d._type=c.Verantwoordingtype,d._code=null!=(g=c.Code)?g:"",d._appointment=b.Appointment._convertRaw(a,c.Afspraak),d},a}(),b=null!=(f="undefined"!=typeof module&&null!==module?module.exports:void 0)?f:null!=this.Magister?this.Magister:this.Magister={},b.Assignment=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.name=b._getset("_name"),this.description=b._getset("_description"),this.class=b._getset("_class"),this.deadline=b._getset("_deadline"),this.handedInOn=b._getset("_handedInOn"),this.files=b._getset("_files"),this.teachers=b._getset("_teachers"),this.grade=b._getset("_grade"),this.markedOn=b._getset("_markedOn"),this.handInAgain=b._getset("_handInAgain"),this.finished=b._getset("_finished"),this.canHandIn=b._getset("_canHandIn")}return a.prototype.versions=function(a){var c,d,e,f,g,h;for(d=b._helpers.asyncResultWaiter(this._versionIds.length,function(b){return a(null,b)}),g=this._versionIds,h=[],e=0,f=g.length;e<f;e++)c=g[e],h.push(this._magisterObj.http.get(""+this._magisterObj._personUrl+"/opdrachten/versie/"+c,{},function(c){return function(e,f){return null!=e?a(e,null):d(b.AssignmentVersion._convertRaw(c._magisterObj,c,JSON.parse(f.content)))}}(this)));return h},a._convertRaw=function(a,c){var d,e,f,g;return e=new b.Assignment(a),e._id=c.Id,e._name=c.Titel,e._description=c.Omschrijving,e._class=c.Vak,e._deadline=b._helpers.parseDate(c.InleverenVoor),e._handedInOn=b._helpers.parseDate(c.IngeleverdOp),e._files=function(){var e,f,g,h;for(g=c.Bijlagen,h=[],e=0,f=g.length;e<f;e++)d=g[e],h.push(b.File._convertRaw(a,void 0,d));return h}(),e._teachers=null!=c.Docenten?function(){var d,e,g,h;for(g=c.Docenten,h=[],d=0,e=g.length;d<e;d++)f=g[d],h.push(b.Person._convertRaw(a,f));return h}():void 0,e._versionIds=function(){var a,b,d,e;for(d=c.VersieNavigatieItems,e=[],a=0,b=d.length;a<b;a++)g=d[a],e.push(g.Id);return e}(),e._grade=c.Beoordeling,e._markedOn=b._helpers.parseDate(c.BeoordeeldOp),e._handInAgain=c.OpnieuwInleveren,e._finished=c.Afgesloten,e._canHandIn=c.MagInleveren,e},a}(),b.AssignmentVersion=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.class=b._getset("_class"),this.state=b._getset("_state"),this.pupilMessage=b._getset("_pupilMessage"),this.teacherNotice=b._getset("_teacherNotice"),this.handedInFiles=b._getset("_handedInFiles"),this.feedbackFiles=b._getset("_feedbackFiles"),this.deadline=b._getset("_deadline"),this.handedInOn=b._getset("_handedInOn"),this.grade=b._getset("_grade"),this.markedOn=b._getset("_markedOn"),this.version=b._getset("_version"),this.tooLate=b._getset("_tooLate")}return a._convertRaw=function(a,c,d){var e,f;return f=new b.AssignmentVersion(a),f._id=d.Id,f._class=c._class,f._state=d.Status,f._pupilMessage=d.LeerlingOpmerking,f._teacherNotice=d.DocentOpmerking,f._handedInFiles=function(){var c,f,g,h;for(g=d.LeerlingBijlagen,h=[],c=0,f=g.length;c<f;c++)e=g[c],h.push(b.File._convertRaw(a,void 0,e));return h}(),f._feedbackFiles=function(){var c,f,g,h;for(g=d.FeedbackBijlagen,h=[],c=0,f=g.length;c<f;c++)e=g[c],h.push(b.File._convertRaw(a,void 0,e));return h}(),f._deadline=b._helpers.parseDate(d.InleverenVoor),f._handedInOn=b._helpers.parseDate(d.IngeleverdOp),f._grade=d.Beoordeling,f._markedOn=b._helpers.parseDate(d.BeoordeeldOp),f._version=d.VersieNummer,f._tooLate=d.IsTeLaat,f},a}(),b=null!=(k="undefined"!=typeof module&&null!==module?module.exports:void 0)?k:null!=this.Magister?this.Magister:this.Magister={},b.Class=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.beginDate=b._getset("_beginDate"),this.endDate=b._getset("_endDate"),this.abbreviation=b._getset("_abbreviation"),this.description=b._getset("_description"),this.number=b._getset("_number"),this.teacher=b._getset("_teacher"),this.classExemption=b._getset("_classExemption")}return a._convertRaw=function(a,c){var d,e,f,g,h;return d=new b.Class(a),d._id=null!=(e=c.id)?e:c.Id,d._beginDate=b._helpers.parseDate(c.begindatum),d._endDate=b._helpers.parseDate(c.einddatum),d._abbreviation=null!=(f=c.afkorting)?f:c.Afkorting,d._description=null!=(g=c.omschrijving)?g:c.Omschrijving,d._number=null!=(h=c.volgnr)?h:c.Volgnr,d._teacher=b.Person._convertRaw(a,{Docentcode:c.docent}),d._classExemption=c.VakDispensatie||c.VakVrijstelling,d},a}(),b.Course=function(){function a(a){this._magisterObj=a,this.getOtherTutors=t(this.getOtherTutors,this),this.id=b._getset("_id"),this.begin=b._getset("_begin"),this.end=b._getset("_end"),this.schoolPeriod=b._getset("_schoolPeriod"),this.type=b._getset("_type"),this.group=b._getset("_group"),this.profile=b._getset("_profile"),this.alternativeProfile=b._getset("_alternativeProfile"),this.current=b._getset("_current")}return a.prototype.classes=function(a){return this._magisterObj.http.get(this._classesUrl,{},function(c){return function(d,e){var f;return null!=d?a(d,null):a(null,function(){var a,c,d,g;for(d=JSON.parse(e.content),g=[],a=0,c=d.length;a<c;a++)f=d[a],g.push(b.Class._convertRaw(this._magisterObj,f));return g}.call(c))}}(this))},a.prototype.gradePeriods=function(a){return this._magisterObj.http.get(this._periodsUrl,{},function(c){return function(d,e){var f;return null!=d?a(d,null):a(null,function(){var a,c,d,g;for(d=JSON.parse(e.content).Items,g=[],a=0,c=d.length;a<c;a++)f=d[a],g.push(b.GradePeriod._convertRaw(this._magisterObj,f));return g}.call(c))}}(this))},a.prototype.grades=function(){var a,d,e,f,g,h;if(g=null!=(h=c.find(arguments,function(a){return c.isPlainObject(a)}))?h:{},e=g.fillPersons,d=g.fillGrade,a=c.find(arguments,function(a){return c.isFunction(a)}),null==a)throw new Error("Callback can't be null");return null==e&&(e=!1),null==d&&(d=!0),f=!1,this._magisterObj.http.get(f?this._gradesUrlPrefix:this._gradesUrl,{},function(g){return function(h,i){var j,k,l,m,n;if(null!=h)return a(h,null);for(i=JSON.parse(i.content).Items,i=c.filter(i,function(a){return 0!==a.CijferId}),j=b._helpers.asyncResultWaiter(i.length,function(b){return c.chain(b).uniq(function(a){return a.class().id}).pluck("_class").forEach(function(a){var d,e,f,g,h;for(g=c.filter(b,function(b){return b.class().id===a.id}),h=[],e=0,f=g.length;e<f;e++)d=g[e],h.push(d._class=a);return h}),a(null,c.sortBy(b,function(a){return a.dateFilledIn()}))}),n=[],l=0,m=i.length;l<m;l++)k=i[l],n.push(function(c){var h,i,k;return h=b.Grade._convertRaw(g._magisterObj,c),h._columnUrl=g._columnUrlPrefix+(null!=(k=c.CijferKolom)?k.Id:void 0),i=b._helpers.asyncResultWaiter(2,function(){return j(h)}),e&&!f?g._magisterObj.getPersons(h.Docent,3,function(a,b){return null==a&&null!=b[0]&&(h._teacher=b[0]),i()}):i(),d&&!f?h.fillGrade(function(b,c){return null!=b?a(b,null):i()}):i()}(k));return n}}(this))},a.prototype.getPersonalTutor=function(a){if(null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/aanmeldingen/"+this._id+"/mentor",{},function(c){return function(d,e){return null!=d?a(d,null):a(null,b.Person._convertRaw(c._magisterObj,JSON.parse(e.content)))}}(this))},a.prototype.getOtherTutors=function(a){if(null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/aanmeldingen/"+this._id+"/mentoren",{},function(c){return function(d,e){var f,g;return null!=d?a(d,null):(f=JSON.parse(e.content).items,a(null,function(){var a,c,d;for(d=[],a=0,c=f.length;a<c;a++)g=f[a],d.push(b.Person._convertRaw(this._magisterObj,g));return d}.call(c)))}}(this))},a._convertRaw=function(a,d){var e,f,g,h;return f=new b.Course(a),f._classesUrl=a._personUrl+("/aanmeldingen/"+d.Id+"/vakken"),f._gradesUrlPrefix=a._personUrl+("/aanmeldingen/"+d.Id+"/cijfers"),f._gradesUrl=f._gradesUrlPrefix+"/cijferoverzichtvooraanmelding?actievePerioden=false&alleenBerekendeKolommen=false&alleenPTAKolommen=false",f._periodsUrl=f._gradesUrlPrefix+"/cijferperiodenvooraanmelding",f._columnUrlPrefix=f._gradesUrlPrefix+"/extracijferkolominfo/",f._id=d.Id,f._begin=b._helpers.parseDate(d.Start),f._end=b._helpers.parseDate(d.Einde),f._schoolPeriod=d.Lesperiode,f._type={id:d.Studie.Id,description:d.Studie.Omschrijving},f._group={id:d.Groep.Id,description:(e=d.Groep.Omschrijving,null!=e?null!=(g=c.find(e.split(" "),function(a){return/\d/.test(a)}))?g:e:void 0),locationId:d.Groep.LocatieId},f._profile=d.Profiel,f._alternativeProfile=d.Profiel2,f._current=f._begin.getTime()<=(h=c.now())&&h<=f._end.getTime(),f},a}(),b=null!=(l="undefined"!=typeof module&&null!==module?module.exports:void 0)?l:null!=this.Magister?this.Magister:this.Magister={},b.DigitalSchoolUtility=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.type=b._getset("_type"),this.name=b._getset("_name"),this.publisher=b._getset("_publisher"),this.state=b._getset("_state"),this.begin=b._getset("_begin"),this.end=b._getset("_end"),this.EAN=b._getset("_EAN"),this.url=b._getset("_url"),this.class=b._getset("_class")}return a._convertRaw=function(a,d){var e,f;return e=new b.DigitalSchoolUtility(a),e._id=d.Id,e._type=d.MateriaalType,e._name=d.Titel,e._publisher=d.Uitgeverij,e._state=d.Status,e._begin=b._helpers.parseDate(d.Start),e._end=b._helpers.parseDate(d.Eind),e._EAN=Number(d.EAN),e._url=null!=(f=c.find(d.Links,function(a){return"content"===a.Rel}))?f.Href:void 0,e._class=b.Class._convertRaw(a,d.Vak),e},a}(),b=null!=(n="undefined"!=typeof module&&null!==module?module.exports:void 0)?n:null!=this.Magister?this.Magister:this.Magister={},b.FileFolder=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.name=b._getset("_name"),this.rights=b._getset("_rights"),this.parentId=b._getset("_parentId")}return a.prototype.files=function(a){return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/bronnen?parentId="+this.id(),{},function(c){return function(d,e){var f,g,h,i,j,k;if(null!=d)return a(d,null);for(g=function(){var a,c,d,g;for(d=JSON.parse(e.content).Items,g=[],a=0,c=d.length;a<c;a++)f=d[a],g.push(b.File._convertRaw(this._magisterObj,this,f));return g}.call(c),h=b._helpers.asyncResultWaiter(g.length,function(b){return a(null,g)}),k=[],i=0,j=g.length;i<j;i++)f=g[i],k.push(function(a){return c._magisterObj.getPersons(a.GeplaatstDoor,function(b,c){return null==b&&0!==c.length&&(a._addedBy=c[0]),h()})}(f));return k}}(this))},a._convertRaw=function(a,c){var d;return d=new b.FileFolder(a),d._id=c.Id,d._name=c.Naam,d._rights=c.Privilege,d._parentId=c.ParentId,d},a}(),b.File=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.type=b._getset("_type"),this.name=b._getset("_name",function(a){return function(b){return a._name=b,a._update()}}(this)),this.uri=b._getset("_uri"),this.size=b._getset("_size"),this.rights=b._getset("_rights"),this.mime=b._getset("_mime"),this.changedDate=b._getset("_changedDate"),this.creationDate=b._getset("_creationDate"),this.addedBy=b._getset("_addedBy"),this.fileBlobId=b._getset("_fileBlobId"),this.fileFolder=b._getset("_fileFolder",this.move),this.uniqueId=b._getset("_uniqueId"),this.referenceId=b._getset("_referenceId")}return a.prototype.download=function(){var a,b,d,e,f,g;if(b=null==(g=c.find(arguments,function(a){return c.isString(a)||c.isBoolean(a)}))||g,a=c.find(arguments,function(a){return c.isFunction(a)}),"undefined"!=typeof Meteor&&null!==Meteor?Meteor.isServer:void 0)f=Npm.require("request"),d=Npm.require("fs");else{if(null==("undefined"!=typeof module&&null!==module?module.exports:void 0))return void("function"==typeof a&&a(new Error("`File.download` is only accessible from the server at the moment.\nYou can set a proxy yourself with something like iron:router serverside routes."),null));f=require("request"),d=require("fs")}b=c.isBoolean(b)&&b?this.name():c.isString(b)?/(\.{1,2}\/?)*$/.test(b)?b+="/"+this.name():b:void 0,e=f({url:this._downloadUrl,method:"GET",headers:this._magisterObj.http._cookieInserter(),encoding:null}).on("error",function(b){return"function"==typeof a?a(b,null):void 0}).on("response",function(b){return"function"==typeof a?a(null,""):void 0}),null!=b&&e.pipe(require("fs").createWriteStream(b))},a.prototype.move=function(a){return this._magisterObj.fileFolders(function(d){return function(e,f){if(null!=e)throw e;return c.isObject(a)||(a=c.find(f,function(c){return b._helpers.contains(c.name(),a,!0)||c.id()===a})),d._fileFolder=a,d._update()}}(this))},a.prototype.remove=function(){return this._magisterObj.http.delete(""+this._magisterObj._personUrl+"/bronnen/"+this.id(),{},function(a,b){if(null!=a)throw a})},a.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/bronnen/"+this.id(),this._toMagisterStyle(),{},function(){})},a.prototype._toMagisterStyle=function(){var a;return a={},a.Id=parseInt(this._id,10),a.BronSoort=this._type,a.Naam=this._name,a.Uri=this._uri,a.Grootte=this._size,a.Privilege=this._rights,a.ContentType=this._mime,a.FileBlobId=null!=this._fileBlobId?parseInt(this._fileBlobId,10):void 0,a.ParentId=this._fileFolder.id(),a.UniqueId=this._uniqueId,a.Referentie=null!=this._referenceId?parseInt(this._referenceId,10):void 0,a},a._convertRaw=function(a,d,e){var f,g,h,i,j,k;return null!=e._addedBy?f=e._addedBy:(f=new b.Person(a,null,"",""),f._fullName=e.GeplaatstDoor),h=new b.File(a),h._id=e.Id.toString(),h._type=e.BronSoort,h._name=e.Naam,h._uri=e.Uri,h._size=e.Grootte,h._rights=e.Privilege,h._mime=e.ContentType,h._changedDate=b._helpers.parseDate(e.GewijzigdOp),h._creationDate=b._helpers.parseDate(null!=(i=e.GemaaktOp)?i:e.Datum),h._addedBy=f,h._fileBlobId=null!=(j=e.FileBlobId)?j.toString():void 0,h._fileFolder=d,h._uniqueId=e.UniqueId,h._referenceId=null!=(k=e.Referentie)?k.toString():void 0,g=c.find(e.Links,{Rel:"Contents"}),null==g&&(g=c.find(e.Links,{Rel:"Self"})),/^https?/.test(g.Href)?h._downloadUrl=g.Href:h._downloadUrl=a.magisterSchool.url+g.Href,h},a}(),b=null!=(o="undefined"!=typeof module&&null!==module?module.exports:void 0)?o:null!=this.Magister?this.Magister:this.Magister={},b.Grade=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.grade=b._getset("_grade"),this.passed=b._getset("_passed"),this.dateFilledIn=b._getset("_dateFilledIn"),this.testDate=b._getset("_testDate"),this.period=b._getset("_period"),this.class=b._getset("_class"),this.atLaterDate=b._getset("_atLaterDate"),this.exemption=b._getset("_exemption"),this.counts=b._getset("_counts"),this.type=b._getset("_type"),this.teacher=b._getset("_teacher"),this.classExemption=b._getset("_classExemption"),this.description=b._getset("_description"),this.weight=b._getset("_weight")}return a.prototype.fillGrade=function(a){return this._filled?"function"==typeof a?a(null,this):void 0:this._magisterObj.http.get(this._columnUrl,{},function(d){return function(e,f){var g,h;return null!=e?"function"==typeof a?a(e,null):void 0:(f=JSON.parse(f.content),d._testDate=b._helpers.parseDate(f.WerkinformatieDatumIngevoerd),d._description=null!=(g=f.WerkInformatieOmschrijving)?g:"",d._weight=Number(f.Weging),c.isNaN(d._weight)&&(d._weight=0),d._type._level=f.KolomNiveau,d._type._description=null!=(h=f.KolomOmschrijving)?h:"",d._filled=!0,"function"==typeof a?a(null,d):void 0)}}(this))},a._convertRaw=function(a,c){var d,e,f,g,h,i;return d=new b.Grade(a),d._id=c.CijferId,d._grade=c.CijferStr,d._passed=c.IsVoldoende,d._dateFilledIn=b._helpers.parseDate(c.DatumIngevoerd),d._period=(e=new b.GradePeriod(a),e._id=c.CijferPeriode.Id,e._name=null!=(g=c.CijferPeriode.Naam)?g:"",e),d._class={id:c.Vak.Id,abbreviation:null!=(h=c.Vak.Afkorting)?h:"",description:null!=(i=c.Vak.Omschrijving)?i:""},d._atLaterDate=c.Inhalen,d._exemption=c.Vrijstelling,d._counts=c.TeltMee,null!=(f=c.CijferKolom)&&(d._type=b.GradeType._convertRaw(a,f)),d._assignmentId=c.CijferKolomIdEloOpdracht,d._teacher=b.Person._convertRaw(a,{Docentcode:c.Docent}),d._teacher._type=3,d._classExemption=c.VakDispensatie||c.VakVrijstelling,d._description="",d._weight=0,d},a}(),b.GradeType=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.name=b._getset("_name"),this.number=b._getset("_number"),this.header=b._getset("_header"),this.description=b._getset("_description"),this.type=b._getset("_type"),this.typeString=b._getset("_type",null,function(a){switch(a){case 1:return"grade";case 2:return"average";case 3:return"maximum";case 4:return"formula";case 5:return"minimum";case 6:return"sum";case 7:return"count";case 8:return"cevo";case 9:return"text";case 10:return"cevocpe";case 11:return"cevocie";case 12:return"weight";case 13:return"end";case 14:return"deficit";default:return"unknown"}}),this.isAtLaterDate=b._getset("_isAtLaterDate"),this.isTeacher=b._getset("_isTeacher"),this.hasNestedTypes=b._getset("_hasNestedTypes"),this.isPTA=b._getset("_isPTA"),this.level=b._getset("_level"),this.isEnd=function(){var a;return 2===(a=this.type())||13===a}}return a._convertRaw=function(a,c){var d;return d=new b.GradeType(a),d._id=c.Id,d._name=c.KolomNaam,d._number=c.KolomNummer,d._header=c.KolomKop,d._type=c.KolomSoort,d._isAtLaterDate=c.IsHerkansingKolom,d._isTeacher=c.IsDocentKolom,d._hasNestedTypes=c.HeeftOndeliggendeKolommen,d._isPTA=c.IsPTAKolom,d._level=null,d._description="",d},a}(),b.GradePeriod=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.begin=b._getset("_begin"),this.end=b._getset("_end"),this.name=b._getset("_name"),this.description=b._getset("_description")}return a._convertRaw=function(a,c){var d,e,f;return d=new b.GradePeriod(a),d._id=c.Id,d._begin=b._helpers.parseDate(c.Start),d._end=b._helpers.parseDate(c.Einde),d._name=null!=(e=c.Naam)?e:"",d._description=null!=(f=c.Omschrijving)?f:"",d},a}(),b=null!=(p="undefined"!=typeof module&&null!==module?module.exports:void 0)?p:null!=this.Magister?this.Magister:this.Magister={},"undefined"!=typeof Meteor&&null!==Meteor)this._=c=lodash;else if(null==("undefined"!=typeof module&&null!==module?module.exports:void 0)||"undefined"==typeof require||null===require||"undefined"!=typeof window&&null!==window){if(null==this._)throw new Error("Lo-dash or underscore is required.");c=this._}else null==c&&(this._=c=require("lodash"));b.VERSION="1.22.0",b.Magister=function(){function a(){var a,d,e,f,g;if(d={keepLoggedIn:!0,login:!0},1===arguments.length&&c.isObject(arguments[0]))d=c.extend(d,arguments[0]);else{if(3!==arguments.length&&4!==arguments.length)throw new Error("Expected 3 or 4 arguments, got "+arguments.length);f=arguments[0],g=arguments[1],e=arguments[2],a=arguments[3],d=c.extend(d,{school:f,username:g,password:e,keepLoggedIn:a})}if(null==d.school||null==d.sessionId&&(c.isEmpty(d.username)||c.isEmpty(d.password)))throw new Error("school, username and password are required.");this._readyCallbacks=[],this.http=new b.MagisterHttp,this.magisterSchool=d.school,this.username=d.username,this.password=d.password,this._keepLoggedIn=d.keepLoggedIn,c.isString(this.magisterSchool)?b.MagisterSchool.getSchools(this.magisterSchool,function(a){return function(b,c){return null!=b?a._setErrored(b):0===c.length?a._setErrored(new Error("No school with the query "+a.magisterSchool+" found.")):(a.magisterSchool=c[0],d.login?a._reLogin(d.sessionId):void 0)}}(this)):(this.magisterSchool=c.extend(new b.MagisterSchool,this.magisterSchool),d.login&&this._reLogin(d.sessionId))}return a.prototype.appointments=function(){var a,d,e,f,g,h,i,j,k,l;return a=c.find(arguments,function(a){return c.isFunction(a)}),k=c.filter(arguments,function(a){return c.isBoolean(a)}),f=k[0],h=k[1],null==f&&(f=!1),null==h&&(h=!0),e=c.filter(arguments,c.isDate),l=c.sortBy(e),g=l[0],i=l[1],null==i&&(i=g),g=b._helpers.date(g),i=b._helpers.date(i),this._forceReady(),d=b._helpers.urlDateConvert,j=""+this._personUrl+"/afspraken?tot="+d(i)+"&van="+d(g),this.http.get(j,{},function(e){return function(j,k){var l,m,n,o,p,q,r,s;if(null!=j)return a(j,null);if(k=JSON.parse(k.content),n=function(){var a,c,d,e;for(d=k.Items,e=[],a=0,c=d.length;a<c;a++)l=d[a],e.push(b.Appointment._convertRaw(this,l));return e}.call(e),m=null,o=b._helpers.asyncResultWaiter(2,function(b){return c.each(n,function(a){return a._absenceInfo=c.find(m,function(b){return b.appointment().id()===a.id()})}),n=c.chain(n).sortBy("_begin").value(),a(null,n)}),e.http.get(""+e._personUrl+"/absenties?tot="+d(i)+"&van="+d(g),{},function(c,d){return null!=c?h?o():a(c,null):(d=JSON.parse(d.content).Items,m=d.map(function(a){return b.AbsenceInfo._convertRaw(e,a)}),o())}),f){for(p=b._helpers.asyncResultWaiter(n.length,function(){return o()}),s=[],q=0,r=n.length;q<r;q++)l=n[q],s.push(function(a){var b;return b=a.teachers(),e.fillPersons(b,function(b,c){return a._teachers=c,p()},3)}(l));return s}return o()}}(this))},a.prototype.createAppointment=function(a,d){var e,f,g,h,i,j,k,l,m,n,o;for(this._forceReady(),h=["name","start","end"],j=0,k=h.length;j<k;j++)if(f=h[j],null==a[f])return void d(new Error("Not all required fields for `options` are given, required are: [ "+h.join(", ")+" ]"),null);return i=a.fullDay?b._helpers.date(a.start):a.start,g={Start:b._helpers.toUtcString(i),Einde:b._helpers.toUtcString(a.fullDay?new Date(i.getTime()+864e5):a.end),Omschrijving:a.name,Lokatie:null!=(m=a.location)?m:"",Inhoud:(e=null!=(n=a.content)?n.trim():void 0,null!=e&&e.length>0?c.escape(a.content):null),Type:null!=(o=a.type)?o:1,DuurtHeleDag:null!=(l=a.fullDay)&&l,InfoType:0,WeergaveType:1,Status:2,HeeftBijlagen:!1,Bijlagen:null,LesuurVan:null,LesuurTotMet:null,Aantekening:null,Afgerond:!1,Vakken:null,Docenten:null,Links:null,Id:0,Lokalen:null,Groepen:null,OpdrachtId:0},this.http.post(""+this._personUrl+"/afspraken",g,{},function(a){return function(c,e){var f;return null!=c?d(c,null):(f=b.Appointment._convertRaw(a,g),f._url=a.magisterSchool.url+JSON.parse(e.content).Url,d(null,f))}}(this))},a.prototype.messageFolders=function(a,d){var e;return this._forceReady(),null!=d?void this._fetchMessageFolders(function(b){return function(c,e){return null!=c?d(c,null):d(null,b.messageFolders(a))}}(this)):(a=null!=a?a.trim():void 0,e=c.isString(a)?c.filter(this._messageFolders,function(c){return b._helpers.contains(c.name(),a,!0)}):this._messageFolders,null!=e?e:[])},a.prototype._fetchMessageFolders=function(a){return this.http.get(""+this._personUrl+"/berichten/mappen",{},function(c){return function(d,e){var f;return null!=d?(d.statusCode=null!=e?e.statusCode:void 0,a(d)):(c._messageFolders=function(){var a,c,d,g;for(d=JSON.parse(e.content).Items,g=[],a=0,c=d.length;a<c;a++)f=d[a],g.push(b.MessageFolder._convertRaw(this,f));return g}.call(c),a(null))}}(this))},a.prototype.inbox=function(){return this.messageFolders("postvak in")[0]},a.prototype.sentItems=function(){return this.messageFolders("verzonden items")[0]},a.prototype.bin=function(){return this.messageFolders("verwijderde items")[0]},a.prototype.alerts=function(){return this.messageFolders("mededelingen")[0]},a.prototype.courses=function(a){var d;return this._forceReady(),d=""+this._personUrl+"/aanmeldingen",this.http.get(d,{},function(d){return function(e,f){var g,h;return null!=e?a(e,null):(f=JSON.parse(f.content),h=function(){var a,c,d,e;for(d=f.Items,e=[],a=0,c=d.length;a<c;a++)g=d[a],e.push(b.Course._convertRaw(this,g));return e}.call(d),a(null,c.chain(h).sortBy("_beginDate").sortBy(function(a){return!a._current}).value()))}}(this))},a.prototype.currentCourse=function(a){return this._forceReady(),this.courses(function(b,d){return null!=b?a(b,null):a(null,c.find(d,function(a){return a.current()}))})},a.prototype.getLimitedCurrentCourseInfo=function(a){var b;return this._forceReady(),b=""+this._personUrl+"/opleidinggegevensprofiel",this.http.get(b,{},function(b,d){var e,f,g,h,i,j;if(null!=b)return a(b,null);try{return g=JSON.parse(d.content),a(null,{group:(f=g.Klas,null!=f?null!=(h=c.find(f.split(" "),function(a){return/\d/.test(a)}))?h:f:void 0),profile:g.Profielen,pupilId:g.StamNr,type:{year:+(null!=(i=/\d+/.exec(g.Studie))?i[0]:void 0),schoolVariant:null!=(j=/[^\d\s]+/.exec(g.Studie))?j[0]:void 0}})}catch(b){return e=b,a(e,null)}})},a._cachedPersons={},a.prototype.getPersons=function(){var a,d,e,f,g,h,i,j,k;return this._forceReady(),k=c.filter(arguments,function(a){return c.isString(a)}),f=k[0],h=k[1],e=c.find(arguments,function(a){return c.isFunction(a)}),f=null!=f?f.trim():"",f.length<3?(e(null,[]),!1):null==h?(a=d=!1,a=this.getPersons(f,"teacher",function(a){return function(b,c){var g;return null!=b?e(b,null):(g=c,d=a.getPersons(f,"pupil",function(a,b){return null!=a?e(a,null):e(null,b.concat(g))}))}}(this)),a||d):(g=function(){switch(h){case"teacher":return"Personeel";case"pupil":return"Leerling";case"project":return"Project";default:return"Overig"}}(),i=""+this._personUrl+"/contactpersonen?contactPersoonType="+g+"&q="+f.replace(/\ +/g,"+"),null!=(j=b.Magister._cachedPersons[""+this._id+h+f])?(b._helpers.defer(e,null,j),!0):(this.http.get(i,{},function(a){return function(c,d){var g;return null!=c?e(c,null):(d=function(){var a,c,e,f;for(e=JSON.parse(d.content).Items,f=[],a=0,c=e.length;a<c;a++)g=e[a],f.push(b.Person._convertRaw(this,g));return f}.call(a),b.Magister._cachedPersons[""+a._id+h+f]=d,e(null,d))}}(this)),!1))},a.prototype.fillPersons=function(a,d,e){var f,g,h,i,j,k;if(this._forceReady(),c.isArray(a)){if(0===a.length)return void d(null,[]);for(g=b._helpers.asyncResultWaiter(a.length,function(a){return d(null,a)}),h=0,i=a.length;h<i;h++){f=a[h];try{this.getPersons(c.last(f.fullName().split(" ")),null!=(j=f._type)?j:e,function(a,b){var c;return g(null!=(c=b[0])?c:f)})}catch(a){g(f)}}}else{if(!c.isObject(a))throw new Error("Expected persons to be an Array or an Object, got a(n) "+typeof a);try{this.getPersons(c.last(a.fullName().split(" ")),null!=(k=a._type)?k:e,function(b,c){var e;return d(null,null!=(e=c[0])?e:a)})}catch(b){d(null,a)}}},a.prototype.composeAndSendMessage=function(){var a,d,e,f,g,h;return this._forceReady(),h=c.filter(arguments,c.isString),g=h[0],a=h[1],d=c.find(arguments,c.isFunction),f=c.last(c.filter(arguments,function(a){return a!==d})),e=new b.Message(this),e.subject(g),
e.body(null!=a?a:""),e.addRecipient(f),e.send(d)},a.prototype.fileFolders=function(a){return this._forceReady(),this.http.get(""+this._personUrl+"/bronnen?soort=0",{},function(c){return function(d,e){var f;return null!=d?a(d,null):a(null,function(){var a,c,d,g;for(d=JSON.parse(e.content).Items,g=[],a=0,c=d.length;a<c;a++)f=d[a],g.push(b.FileFolder._convertRaw(this,f));return g}.call(c))}}(this))},a.prototype.studyGuides=function(a){var d,e,f;return this._forceReady(),e=null==(f=c.find(arguments,function(a){return c.isBoolean(a)}))||f,a=c.find(arguments,function(a){return c.isFunction(a)}),d=function(d){return function(e){return d.http.get(""+d._pupilUrl+"/studiewijzers?peildatum="+b._helpers.urlDateConvert(new Date),{},function(f,g){var h,i,j,k,l;if(null!=f)return a(f,null);for(g=function(){var a,c,d,e;for(d=JSON.parse(g.content).Items,e=[],a=0,c=d.length;a<c;a++)h=d[a],e.push(b.StudyGuide._convertRaw(this,h));return e}.call(d),j=function(a){return null!=e?a._class=c.find(e,function(b){return b.abbreviation()===a._class}):a._class=null},k=0,l=g.length;k<l;k++)i=g[k],j(i);return a(null,g)})}}(this),e?this.courses(function(a,b){return null!=b&&0!==b.length?b[0].classes(function(a,b){return null!=b&&0!==b.length?d(b):d()}):d()}):d()},a.prototype.assignments=function(){var a,d,e,f,g,h,i,j;if(this._forceReady(),i=c.filter(arguments,function(a){return c.isNumber(a)}),a=i[0],h=i[1],j=c.filter(arguments,function(a){return c.isBoolean(a)}),g=j[0],f=j[1],d=c.find(arguments,function(a){return c.isFunction(a)}),null!=d)return null==g&&(g=!1),null==f&&(f=!0),null==a&&(a=50),null==h&&(h=0),e=function(e){return function(f){return e.http.get(""+e._personUrl+"/opdrachten?skip="+h+"&top="+a+"&status=alle",{},function(a,h){var i,j,k,l,m,n;if(null!=a)return d(a,null);for(h=function(){var a,b,c,d;for(c=JSON.parse(h.content).Items,d=[],a=0,b=c.length;a<b;a++)i=c[a],d.push(i.Id);return d}(),k=b._helpers.asyncResultWaiter(h.length,function(a){return d(null,a)}),n=[],l=0,m=h.length;l<m;l++)j=h[l],n.push(e.http.get(""+e._personUrl+"/opdrachten/"+j,{},function(a,d){var h,i,j;return h=b.Assignment._convertRaw(e,JSON.parse(d.content)),null!=f?h._class=c.find(f,function(a){return a.abbreviation()===h._class}):h._class=null,g?(i=null!=(j=h.teachers())?j:[],e.fillPersons(i,function(a,b){return h._teachers=b,k(h)},3)):k(h)}));return n})}}(this),f?this.courses(function(a,b){return null!=b&&0!==b.length?b[0].classes(function(a,b){return null!=b&&0!==b.length?e(b):e()}):e()}):e()},a.prototype.digitalSchoolUtilities=function(){var a,d,e,f;if(this._forceReady(),d=null==(f=c.find(arguments,function(a){return c.isBoolean(a)}))||f,a=c.find(arguments,function(a){return c.isFunction(a)}),null!=a)return e=""+this._personUrl+"/lesmateriaal",this.http.get(e,{},function(d){return function(e,f){var g,h;return null!=e?a(e,null):(g=c.partial(b.DigitalSchoolUtility._convertRaw,d),h=JSON.parse(f.content).Items,a(null,c.map(h,g)))}}(this))},a.prototype.profileInfo=function(){return this._forceReady(),this._profileInfo},a.prototype.children=function(d){return this.http.get(""+this._personUrl+"/kinderen",{},function(e){return function(f,g){var h,i,j,k,l,m,n,o;if(null!=f)return d(f,null);if(j=JSON.parse(g.content),null!=j.ExceptionId&&1===j.Reason)return void d(c.extend(j,{message:"User is not a parent."}),null);for(l=[],o=j.Items,m=0,n=o.length;m<n;m++)k=o[m],h=b.ProfileInfo._convertRaw(e,k),h._profilePicture=""+e.magisterSchool.url+"/api/personen/"+k.Id+"/foto",l.push((i=new a({school:e.magisterSchool,username:e.username,password:e.password,login:!1}),i.http=e.http,i._id=k.Id,i._personUrl=""+e.magisterSchool.url+"/api/personen/"+i._id,i._pupilUrl=""+e.magisterSchool.url+"/api/leerlingen/"+i._id,i._profileInfo=h,i._ready=!0,i));return d(null,l)}}(this))},a.prototype.ready=function(a){return c.isFunction(a)&&(a=c.bind(a,this),this._ready||null!=this._magisterLoadError?a(this._magisterLoadError):this._readyCallbacks.push(a)),this._ready===!0},a.prototype._forceReady=function(){if(!this._ready)throw new Error("Not done with logging in or errored during logging in! (did you use Magister.ready(callback) to be sure that logging in is done?)")},a.prototype._setReady=function(){var a,b,c,d;for(this._ready=!0,d=this._readyCallbacks,b=0,c=d.length;b<c;b++)(a=d[b])();return this._readyCallbacks=[]},a.prototype._setErrored=function(a,b){var c,d,e,f,g,h;try{e=JSON.parse(a),this._magisterLoadError={};for(d in e)this._magisterLoadError[d.toLowerCase()]=e[d];this._magisterLoadError.toString=function(){var a;return null!=(a=e.message)?a:""}}catch(b){this._magisterLoadError=a}for(null!=b&&(this._magisterLoadError.statusCode=b),h=this._readyCallbacks,f=0,g=h.length;f<g;f++)(c=h[f])(this._magisterLoadError);return this._readyCallbacks=[]},a.prototype._readyCallbacks=[],a.prototype._magisterLoadError=null,a.prototype._reLogin=function(a){var c,d,e,f;return this._ready=!1,this._magisterLoadError=null,this.magisterSchool.url=this.magisterSchool.url.replace(/^https?/,"https"),d=""+this.magisterSchool.url+"/api/sessies/huidige",e=""+this.magisterSchool.url+"/api/sessies",f=function(a){return function(b){return a._sessionId=b,a.http._cookie="SESSION_ID="+a._sessionId+"; M6UserName="+a.username}}(this),c=function(a){return function(){var c;try{return a.http.get(""+a.magisterSchool.url+"/api/account",{},function(c,d){var e;if(null!=c)return void a._setErrored(c,null!=d?d.statusCode:void 0);try{d=JSON.parse(d.content),a._id=d.Persoon.Id,a._personUrl=""+a.magisterSchool.url+"/api/personen/"+a._id,a._pupilUrl=""+a.magisterSchool.url+"/api/leerlingen/"+a._id,a._profileInfo=b.ProfileInfo._convertRaw(a,d.Persoon)}catch(b){return e=b,void a._setErrored(e,null!=d?d.statusCode:void 0)}return a._fetchMessageFolders(function(b){return null!=b?a._setErrored(b,b.statusCode):a._setReady()})})}catch(b){return c=b,a._setErrored(c)}}}(this),null!=a?(f(a),c()):this.http.delete(d,{},function(a){return function(b,d){return null!=b?void a._setErrored(b,null!=d?d.statusCode:void 0):(f(/[a-z\d-]+/.exec(d.headers["set-cookie"][0])[0]),a.http.post(e,{Gebruikersnaam:a.username,Wachtwoord:a.password,IngelogdBlijven:a._keepLoggedIn},{headers:{"Content-Type":"application/json;charset=UTF-8"}},function(b,d){return null!=b?a._setErrored(b,null!=d?d.statusCode:void 0):(f(/[a-z\d-]+/.exec(d.headers["set-cookie"][0])[0]),c())}))}}(this))},a}(),b=null!=(q="undefined"!=typeof module&&null!==module?module.exports:void 0)?q:null!=this.Magister?this.Magister:this.Magister={},a=function(a,c){switch(c){case 1:return a.inbox();case 2:return a.sentItems();case 3:return a.bin();case 4:return a.alerts();default:return b.MessageFolder._convertRaw({Id:c})}},b.Message=function(){function d(c){if(this._magisterObj=c,null==this._magisterObj)throw new Error("Magister instance is null!");this._magisterObj._forceReady(),this._canSend=!0,this._sender=this._magisterObj.profileInfo(),this._recipients=[],this._sendDate=new Date,this._isRead=!1,this._type=1,this._subject="",this._body="",this.id=b._getset("_id"),this.body=b._getset("_body",function(a){return function(b){return a._body=(null!=b?b:"").replace("\n","<br>")}}(this),b._helpers.cleanHtmlContent),this.attachments=b._getset("_attachments"),this.messageFolder=b._getset("_folderId",function(a){return function(b){return a.move(b)}}(this),function(b){return function(c){return a(b._magisterObj,c)}}(this)),this.subject=b._getset("_subject",function(a){return function(b){return a._subject=b}}(this)),this.sender=b._getset("_sender"),this.recipients=b._getset("_recipients"),this.sendDate=b._getset("_sendDate"),this.begin=b._getset("_begin"),this.end=b._getset("_end"),this.isRead=b._getset("_isRead",function(a){return function(b){if(a._isRead!==b&&!a._canSend)return a._isRead=b,a._update()}}(this)),this.state=b._getset("_state"),this.isFlagged=b._getset("_isFlagged"),this.type=b._getset("_type")}return d.prototype._tasks=0,d.prototype._sendAfterFinished=!1,d.prototype._finishedCallback=null,d.prototype._isWorking=function(){return 0!==this._tasks},d.prototype._tickDown=function(){if(0===--this._tasks&&this._sendAfterFinished)return this.send(this._finishedCallback)},d.prototype._reset=function(){return this._tasks=0,this._sendAfterFinished=!1},d.prototype.addRecipient=function(a,d){var e,f,g,h;if(c.isString(a))this._tasks++,this._magisterObj.getPersons(a,d,function(b){return function(c,e){if(null!=c)throw b._reset(),c;if(0!==e.length)return b.recipients().push(e[0]),b._tickDown();throw null!=d?(b._reset(),new Error("Couldn't find a person with the type: \""+d+'" and with the query: "'+a+'"')):(b._reset(),new Error("Couldn't find a person with the query: \""+a+'"'))}}(this));else if(c.isArray(a))for(g=0,h=a.length;g<h;g++)e=a[g],this.addRecipient(e,d);else if(c.isObject(a))this.recipients().push(a);else{if(!c.isNumber(a))throw this._reset(),new Error("Expected recipient to be a String, Number, or an Object, got a(n) "+b._helpers.typeof(a));f=new b.Person(this._magisterObj,"",""),f._id=a,f._type=3,this.recipients().push(f)}},d.prototype.createReplyMessage=function(a){var c,d;return d=0!==this.subject().indexOf("RE: ")?"RE: "+this.subject():d(),c=new b.Message(this._magisterObj),c._sender=this._sender,c._folderId=this._folderId,c._isFlagged=this._isFlagged,c._id=this._id,c._body=(null!=a?""+a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),c._subject=d,c._recipients=[this.sender()],c},d.prototype.createReplyToAllMessage=function(a){var d,e;return e=0!==this.subject().indexOf("RE: ")?"RE: "+this.subject():e(),d=new b.Message(this._magisterObj),d._sender=this._sender,d._folderId=this._folderId,d._isFlagged=this._isFlagged,d._id=this._id,d._body=(null!=a?""+a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),d._subject=e,d._recipients=c.reject(this.recipients(),function(a){return a.id()===this._magisterObj.profileInfo().id()}).concat([this.sender()]),d},d.prototype.createForwardMessage=function(a){var c,d;return d=0!==this.subject().indexOf("FW: ")?"FW: "+this.subject():d(),c=new b.Message(this._magisterObj),c._sender=this._sender,c._folderId=this._folderId,c._isFlagged=this._isFlagged,c._id=this._id,c._body=(null!=a?""+a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),c._subject=d,c},d.prototype.send=function(a){var d;return this._isWorking()?(this._sendAfterFinished=!0,this._finishedCallback=a,!1):(d=function(c){return b._helpers.defer(a,new Error(c),null)},this._canSend?null==this.recipients()||null==this.sender()?void d("both sender and recipients must have a value"):c.isEmpty(this.subject())?void d("subject can't be empty"):(this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten",this._toMagisterStyle(),{},function(b){return function(c,d){return null!=c?"function"==typeof a?a(c,null):void 0:"function"==typeof a?a(null,b):void 0}}(this)),!0):void d("this message is marked as unsendable"))},d.prototype.move=function(a){if(c.isObject(a)&&(a=a.id()),!c.isNumber(a))throw new Error("Could not resolve MessageFolder form the given destination.");if(this._folderId!==a)return this._folderId=a,this._update()},d.prototype.remove=function(a){return this._magisterObj.http.delete(""+this._magisterObj._personUrl+"/berichten/"+this.id(),{},function(b,c){return"function"==typeof a?a(b):void 0})},d.prototype.fillMessage=function(){var a,d,e;return d=null!=(e=c.first(arguments))&&e,a=c.last(arguments),this._filled?b._helpers.defer(a,null,this):null!=a?this._magisterObj.http.get(this._fillUrl,{},function(c){return function(e,f){var g,h,i;return null!=e?"function"==typeof a?a(e,null):void 0:(h=JSON.parse(f.content),c._body=h.Inhoud,c._attachments=function(){var a,c,d,e,f;for(d=null!=(e=h.Bijlagen)?e:[],f=[],a=0,c=d.length;a<c;a++)g=d[a],f.push(b.File._convertRaw(this._magisterObj,void 0,g));return f}.call(c),d?(i=b._helpers.asyncResultWaiter(m.recipients().length+1,function(){return c._filled=!0,"function"==typeof a?a(null,c):void 0}),c._magisterObj.fillPersons(m.recipients(),function(a,b){return m._recipients=b,i(b)}),c._magisterObj.fillPersons(m.sender(),function(a,b){return m._sender=b,i(b)})):(c._filled=!0,"function"==typeof a?a(null,c):void 0))}}(this)):void 0},d.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/"+this.id()+"?berichtSoort="+this.type(),this._toMagisterStyle(),{},function(){})},d.prototype._toMagisterStyle=function(){var a,b;return a={},a.Id=this._id,a.Inhoud=this._body,a.MapId=this._folderId,a.Onderwerp=this._subject,a.Ontvangers=function(){var a,c,d,e;for(d=this._recipients,e=[],a=0,c=d.length;a<c;a++)b=d[a],e.push(b._toMagisterStyle());return e}.call(this),a.VerstuurdOp=this._sendDate,a.Begin=this._begin,a.Einde=this._end,a.IsGelezen=this._isRead,a.Status=this._state,a.HeeftPrioriteit=this._isFlagged,a.Soort=this._type,a},d._convertRaw=function(a,c){var d,e,f;return e=new b.Message(a),e._id=c.Id,e._body=null!=(f=c.Inhoud)?f:"",e._folderId=c.MapId,e._subject=c.Onderwerp,e._sender=b.Person._convertRaw(a,c.Afzender),e._recipients=function(){var e,f,g,h,i;for(g=null!=(h=c.Ontvangers)?h:[],i=[],e=0,f=g.length;e<f;e++)d=g[e],i.push(b.Person._convertRaw(a,d));return i}(),e._sendDate=b._helpers.parseDate(c.VerstuurdOp),e._begin=b._helpers.parseDate(c.Begin),e._end=b._helpers.parseDate(c.Einde),e._isRead=c.IsGelezen,e._state=c.Status,e._isFlagged=c.HeeftPrioriteit,e._type=c.Soort,e._canSend=!1,e._fillUrl=""+a._personUrl+"/berichten/"+e._id+"?berichtSoort="+e._type,e},d}(),b=null!=(r="undefined"!=typeof module&&null!==module?module.exports:void 0)?r:null!=this.Magister?this.Magister:this.Magister={},b.MessageFolder=function(){function a(a){this._magisterObj=a,this.name=b._getset("_name"),this.unreadMessagesCount=b._getset("_unreadMessagesCount"),this.id=b._getset("_id"),this.parentId=b._getset("_parentId")}return a.prototype.messages=function(){var a,d,e,f,g,h,i,j;if(0!==arguments.length)return 1===arguments.length?(g={},a=arguments[0]):(g=arguments[0],a=arguments[1]),f=g.limit,i=g.skip,h=g.readState,e=g.fillPersons,d=g.fill,null==f&&(f=10),null==i&&(i=0),null==h&&(h="all"),null==d&&(d=!0),null==e&&(e=!1),0===f?void b._helpers.defer(a,null,[]):(j=""+this._magisterObj._personUrl+"/berichten?mapId="+this.id()+"&top="+f+"&skip="+i,j+=function(){switch(h){case"read":return"&gelezen=true";case"unread":return"&gelezen=false";default:return""}}(),this._magisterObj.http.get(j,{},function(f){return function(g,h){var i,j,k,l,m,n,o,p;if(null!=g)a(g,null);else if(j=function(){var a,c,d,e;for(d=JSON.parse(h.content).Items,e=[],a=0,c=d.length;a<c;a++)i=d[a],e.push(b.Message._convertRaw(this._magisterObj,i));return e}.call(f),k=b._helpers.asyncResultWaiter(j.length,function(b){return a(null,c.sortBy(b,function(a){return a.sendDate()}).reverse())}),d)for(l=function(b){return b.fillMessage(e,function(b,c){return null!=b?a(b,null):k(c)})},m=0,o=j.length;m<o;m++)i=j[m],l(i);else for(n=0,p=j.length;n<p;n++)i=j[n],k(i)}}(this)))},a.prototype.messageFolders=function(a,d){var e;if(d=null!=(e=null!=d?d:a)?e:function(){},null!=d)return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/berichten/mappen?parentId="+this.id(),{},function(e){return function(f,g){var h,i;return null!=f?d(f,null):(i=function(){var a,c,d,e;for(d=JSON.parse(g.content).Items,e=[],a=0,c=d.length;a<c;a++)h=d[a],e.push(b.MessageFolder._convertRaw(this._magisterObj,h));return e}.call(e),g=c.isString(a)&&""!==a?c.where(i,function(b){return Helpers.contains(b.name(),a,!0)}):i,d(null,g))}}(this))},a.prototype.removeAllMessages=function(){return this._magisterObj.http.delete(""+this._magisterObj._personUrl+"/berichten/map/"+this.id(),{},function(a,b){if(null!=a)throw a})},a.prototype.createMessageFolder=function(a,c){var d;return null==c&&(c=function(){}),d={naam:a,parentId:this.id(),persoonId:this._magisterObj._id},this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten/mappen",d,{},function(a){return function(d,e){return null!=d?c(d,null):c(null,b.MessageFolder._convertRaw(a._magisterObj,JSON.parse(e.content)))}}(this))},a.prototype.remove=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/mappen",this._toMagisterStyle(),{},function(a,b){if(null!=a)throw a})},a.prototype._toMagisterStyle=function(){var a;return a={},a.Naam=this._name,a.OngelezenBerichten=this._unreadMessagesCount,a.Id=this._id,a.ParentId=this._parentId,a},a._convertRaw=function(a,c){var d;return d=new b.MessageFolder(a),d._name=c.Naam,d._unreadMessagesCount=c.OngelezenBerichten,d._id=c.Id,d._parentId=c.ParentId,d},a}(),b=null!=(s="undefined"!=typeof module&&null!==module?module.exports:void 0)?s:null!=this.Magister?this.Magister:this.Magister={},b.Person=function(){function a(c,d,e){this._magisterObj=c,this._firstName=d,this._lastName=e,this.id=b._getset("_id"),this.type=b._getset("_type",function(b){return function(c){return b._type=a._convertType(c,!0)}}(this),a._convertType),this.firstName=b._getset("_firstName"),this.lastName=b._getset("_lastName"),this.namePrefix=b._getset("_namePrefix"),this.fullName=b._getset("_fullName"),this.description=b._getset("_description"),this.group=b._getset("_group"),this.teacherCode=b._getset("_teacherCode"),this.emailAddress=b._getset("_emailAddress")}return a.prototype._toMagisterStyle=function(){var a;return a={},a.Id=this._id,a.Type=4===this._type?3:this._type,a.Voornaam=this._firstName,a.Achternaam=this._lastName,a.Tussenvoegsel=this._namePrefix,a.Naam=this._fullName,a.Omschrijving=this._description,a.Groep=this._group,a.Docentcode=this._teacherCode,a.Emailadres=this._emailAddress,a},a._convertRaw=function(a,c,d){var e,f,g;return e=new b.Person(a,c.Voornaam,c.Achternaam),e._id=c.Id,e._namePrefix=c.Tussenvoegsel,e._fullName=c.Naam,e._description=null!=(f=null!=(g=c.Omschrijving)?g:c.Naam)?f:c.naam,e._group=c.Groep,e._teacherCode=c.Docentcode,e._emailAddress=c.Emailadres,e._type=null!=d?d:c.Type,e},a._convertType=function(a,b){if(null==b&&(b=!0),b){if(c.isNumber(a)){if(1!==a&&2!==a&&3!==a&&6!==a&&8!==a)throw new Error("Invalid value: '"+a+"'.");return a}switch(a.toLowerCase()){case"group":return 1;case"study":return 2;case"person":case"teacher":case"personnel":case"pupil":return 3;case"location":return 6;case"project":return 8;default:throw new Error('Invalid value: "'+a+'".')}}else switch(a){case 1:return"group";case 2:return"study";case 3:return"person";case 6:return"location";case 8:return"project";default:return"unknown"}},a}(),b=null!=(g="undefined"!=typeof module&&null!==module?module.exports:void 0)?g:null!=this.Magister?this.Magister:this.Magister={},b.ProfileInfo=function(){function a(a,c,d,e){this._magisterObj=a,this._firstName=c,this._lastName=d,this._birthDate=e,this.id=b._getset("_id"),this.officialFirstNames=b._getset("_officialFirstNames"),this.initials=b._getset("_initials"),this.namePrefix=b._getset("_namePrefix"),this.officialSurname=b._getset("_officialSurname"),this.birthSurname=b._getset("_birthSurname"),this.birthNamePrefix=b._getset("_birthNamePrefix"),this.useBirthname=b._getset("_useBirthname"),this.firstName=b._getset("_firstName"),this.lastName=b._getset("_lastName"),this.fullName=function(){return this.firstName()+" "+this.lastName()},this.birthDate=b._getset("_birthDate"),this.isChild=b._getset("_isChild"),this.isVisibleForParent=b._getset("_isVisibleForParent")}return a.prototype.profilePicture=function(a,b,c){return null==a&&(a=640),null==b&&(b=640),null==c&&(c=!1),""+this._magisterObj._personUrl+"/foto?width="+a+"&height="+b+"&crop="+c},a.prototype.address=function(a){var c;return c=""+this._magisterObj._personUrl+"/adresprofiel",this._magisterObj.http.get(c,{},function(c,d){var e;return null!=c?a(c,null):(e=JSON.parse(d.content),a(null,b.AddressInfo._convertRaw(this._magisterObj,e)))})},a.prototype.settings=function(a){var c;return c=""+this._magisterObj._personUrl+"/profiel",this._magisterObj.http.get(c,{},function(c){return function(d,e){var f;return null!=d?a(d,null):(f=JSON.parse(e.content),a(null,b.ProfileSettings._convertRaw(c._magisterObj,f)))}}(this))},a._convertRaw=function(a,c){var d;return d=new b.ProfileInfo(a,c.Roepnaam,c.Achternaam,b._helpers.parseDate(c.Geboortedatum)),d._id=c.Id,d._officialFirstNames=c.OfficieleVoornamen,d._initials=c.Voorletters,d._namePrefix=c.Tussenvoegsel,d._officialSurname=c.OfficieleAchternaam,d._birthSurname=c.GeboorteAchternaam,d._birthNamePrefix=c.GeboortenaamTussenvoegsel,d._useBirthname=c.GebruikGeboortenaam,d._isChild=null!=c.ZichtbaarVoorOuder,d._isVisibleForParent=c.ZichtbaarVoorOuder,d},a}(),b.ProfileSettings=function(){function a(a){this._magisterObj=a,this.redirectMagisterMessages=b._getset("_redirectMagisterMessages",function(a){return function(b){return a._redirectMagisterMessages=b}}(this)),this.emailAddress=b._getset("_emailAddress",function(a){return function(b){return a._emailAddress=b}}(this)),this.mobileNumber=b._getset("_mobileNumber",function(a){return function(b){return a._mobileNumber=b}}(this))}return a.prototype.update=function(a){var b;return b=""+this._magisterObj._personUrl+"/profiel",this._magisterObj.http.put(b,this._toMagisterStyle(),{},function(b,c){return a(b)})},a.prototype._toMagisterStyle=function(){var a;return a={},a.EloBerichtenDoorsturen=this._redirectMagisterMessages,a.EmailAdres=this._emailAddress,a.Mobiel=this._mobileNumber,a},a._convertRaw=function(a,c){var d;return d=new b.ProfileSettings(a),d._redirectMagisterMessages=c.EloBerichtenDoorsturen,d._emailAddress=c.EmailAdres,d._mobileNumber=c.Mobiel,d},a}(),this.AddressInfo=function(){function a(){this.postalCode=b._getset("_postalCode"),this.street=b._getset("_street"),this.houseNumber=b._getset("_houseNumber"),this.suffix=b._getset("_suffix"),this.city=b._getset("_city")}return a._convertRaw=function(a,c){var d;return d=new b.AddressInfo,d._postalCode=c.Postcode,d._street=c.Straatnaam,d._houseNumber=c.Huisnummer,d._suffix=c.Toevoeging,d._city=c.Woonplaats,d},a}(),b=null!=(h="undefined"!=typeof module&&null!==module?module.exports:void 0)?h:null!=this.Magister?this.Magister:this.Magister={},b.MagisterSchool=function(){function a(a,b,c){this.id=a,this.name=b,this.url=c}return a.prototype.versionInfo=function(a){return(new b.MagisterHttp).get(""+this.url+"/api/versie",{},function(c,d){var e;return null!=c?a(c,null):(e=JSON.parse(d.content),a(null,{core:e.CoreVersie,api:e.ApiVersie,db:e.DatabaseVersie,product:e.ProductVersie,releasedOn:b._helpers.parseDate(e.ReleaseDatum)}))})},a.getSchools=function(a,c){return null!=a&&a.trim().length>=3?(a=a.replace(/\d/g,"").trim(),(new b.MagisterHttp).get("https://mijn.magister.net/api/schools?filter="+a,{},function(a){return function(b,d){var e;return null!=b?c(b,null):c(null,function(){var a,b,c,f;for(c=JSON.parse(d.content),f=[],a=0,b=c.length;a<b;a++)e=c[a],f.push(this._convertRaw(e));return f}.call(a))}}(this))):void c(null,[])},a._convertRaw=function(a){return new b.MagisterSchool(a.Id,a.Name,a.Url)},a}(),b=null!=(i="undefined"!=typeof module&&null!==module?module.exports:void 0)?i:null!=this.Magister?this.Magister:this.Magister={},b.StudyGuide=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.from=b._getset("_from"),this.to=b._getset("_to"),this.classCodes=b._getset("_classCodes"),this.name=b._getset("_name"),this.archived=b._getset("_archived"),this.class=b._getset("_class")}return a.prototype.parts=function(a){if(null!=a)return this._magisterObj.http.get(""+this._magisterObj._pupilUrl+"/studiewijzers/"+this.id(),{},function(c){return function(d,e){var f,g,h,i,j,k,l;if(null!=d)return a(d,null);for(e=JSON.parse(e.content).Onderdelen.Items,h=b._helpers.asyncResultWaiter(e.length,function(b){return a(null,b)}),k=function(){var a,b,c;for(c=[],a=0,b=e.length;a<b;a++)g=e[a],c.push(g.Id);return c}(),l=[],i=0,j=k.length;i<j;i++)f=k[i],l.push(c._magisterObj.http.get(""+c._magisterObj._pupilUrl+"/studiewijzers/"+c.id()+"/onderdelen/"+f,{},function(d,e){var f,g;return null!=d?a(d,null):(f=JSON.parse(e.content),g=b.StudyGuidePart._convertRaw(c._magisterObj,f),h(g))}));return l}}(this))},a._convertRaw=function(a,c){var d;return d=new b.StudyGuide(a),d._id=c.Id,d._from=b._helpers.parseDate(c.Van),d._to=b._helpers.parseDate(c.TotEnMet),d._classCodes=c.VakCodes,d._class=c.VakCodes[0],d._name=c.Titel,d._archived=c.InLeerlingArchief,d},a}(),b.StudyGuidePart=function(){function a(a){this._magisterObj=a,this.id=b._getset("_id"),this.from=b._getset("_from"),this.to=b._getset("_to"),this.name=b._getset("_name"),this.description=b._getset("_description",null,b._helpers.cleanHtmlContent),this.visible=b._getset("_visible"),this.number=b._getset("_number"),this.files=b._getset("_files")}return a._convertRaw=function(a,c){var d,e,f;return e=new b.StudyGuidePart(a),e._id=c.Id,e._from=b._helpers.parseDate(c.Van),e._to=b._helpers.parseDate(c.TotEnMet),e._name=c.Titel,e._description=null!=(f=c.Omschrijving)?f:"",e._visible=c.IsZichtbaar,e._number=c.Volgnummer,e._files=function(){var e,f,g,h;for(g=c.Bronnen,h=[],e=0,f=g.length;e<f;e++)d=g[e],h.push(b.File._convertRaw(a,void 0,d));return h}(),e},a}(),b=null!=(j="undefined"!=typeof module&&null!==module?module.exports:void 0)?j:null!=this.Magister?this.Magister:this.Magister={},b._helpers=function(){function a(){}return a.addZero=function(a){return a<10?"0"+a:a.toString()},a.toUtcString=function(b){return""+a.addZero(b.getFullYear())+"-"+a.addZero(b.getMonth()+1)+"-"+a.addZero(b.getDate())+"T"+a.addZero(b.getHours())+":"+a.addZero(b.getMinutes())+":"+a.addZero(b.getSeconds())+".0000000Z"},a.contains=function(a,b,c){return null==c&&(c=!1),c?a.toUpperCase().indexOf(b.toUpperCase())>=0:a.indexOf(b)>=0},a.asyncResultWaiter=function(a,b){var d,e;return 0===a&&b([]),e=[],d=a,function(a){if(c.isArray(a)?(e=e.concat(a),d-=a.length):(e.push(a),d--),0===d)return b(e)}},a.urlDateConvert=function(b){return""+b.getFullYear()+"-"+a.addZero(b.getMonth()+1)+"-"+a.addZero(b.getDate())},a.date=function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},a.cleanHtmlContent=function(a){return null!=a?c.unescape(a).replace(/<br\s*\/?>/g,"\n").replace(/<\/\s*p\s*>/g,"\n").replace(/&nbsp;/g," ").replace(/(<[^>]*>)|(&#x200b;)/g,"").replace(/\r?\n/g,"\n").trim():""},a.defer=function(){var a,b;b=arguments[0],a=2<=arguments.length?u.call(arguments,1):[],null!=("undefined"!=typeof Meteor&&null!==Meteor?Meteor.defer:void 0)?Meteor.defer(function(){return b.apply(null,a)}):"undefined"!=typeof setImmediate&&null!==setImmediate?setImmediate(function(){return b.apply(null,a)}):c.defer.apply(c,[b].concat(u.call(a)))},a.parseDate=function(a){var b;if(b=Date.parse(a),!isNaN(b))return a=new Date(b)},a.typeof=function(a){return c.isNull(a)?"null":typeof a},a}(),b._getset=function(a,b,d){return function(e){if(null!=e){if(!c.isFunction(b))throw new Error("Changes on this property aren't allowed");b(e,!0)}return c.isFunction(d)?d(this[a],!1):this[a]}},!function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(a){}var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,c){var d=c?c.type||"":"",e=new b;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),saveAs=void 0;try{saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=b.createElementNS("http://www.w3.org/1999/xhtml","a"),d="download"in c,e=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},f=a.webkitRequestFileSystem,g=a.requestFileSystem||f||a.mozRequestFileSystem,h=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},i=0,j=function(b){var c=function(){"string"==typeof b?(a.URL||a.webkitURL||a).revokeObjectURL(b):b.remove()};a.chrome?c():setTimeout(c,10)},k=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){h(a)}}},l=function(b,h){var l,m,n,o=this,p=b.type,q=!1,r=function(){k(o,["writestart","progress","write","writeend"])},s=function(){!q&&l||(l=(a.URL||a.webkitURL||a).createObjectURL(b)),m?m.location.href=l:void 0==a.open(l,"_blank")&&"undefined"!=typeof safari&&(a.location.href=l),o.readyState=o.DONE,r(),j(l)},t=function(a){return function(){if(o.readyState!==o.DONE)return a.apply(this,arguments)}},u={create:!0,exclusive:!1};o.readyState=o.INIT,h||(h="download"),d?(l=(a.URL||a.webkitURL||a).createObjectURL(b),c.href=l,c.download=h,e(c),o.readyState=o.DONE,r(),j(l)):(a.chrome&&p&&"application/octet-stream"!==p&&(n=b.slice||b.webkitSlice,b=n.call(b,0,b.size,"application/octet-stream"),q=!0),f&&"download"!==h&&(h+=".download"),("application/octet-stream"===p||f)&&(m=a),g?(i+=b.size,g(a.TEMPORARY,i,t(function(a){a.root.getDirectory("saved",u,t(function(a){var c=function(){a.getFile(h,u,t(function(a){a.createWriter(t(function(c){c.onwriteend=function(b){m.location.href=a.toURL(),o.readyState=o.DONE,k(o,"writeend",b),j(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&s();
},["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=o["on"+a]}),c.write(b),o.abort=function(){c.abort(),o.readyState=o.DONE},o.readyState=o.WRITING}),s)}),s)};a.getFile(h,{create:!1},t(function(a){a.remove(),c()}),t(function(a){a.code===a.NOT_FOUND_ERR?c():s()}))}),s)}),s)):s())},m=l.prototype;return m.abort=function(){this.readyState=this.DONE,k(this,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,function(a,b){return new l(a,b)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs})}catch(a){}null==Array.isArray&&(Array.isArray=function(a){return Object.prototype.toString.call("[object Array]"===a)}),null==(d=String.prototype).trim&&(d.trim=function(){return this.length>0?this.replace(/^\s+|\s+$/g,""):""})}).call(this);