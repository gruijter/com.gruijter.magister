<style type="text/css">
	.input-wrap {
		position: relative;
	}
	.fa {
		position: absolute;
		margin-left: 5px;
		margin-top: 7px;

		opacity: 0;
		visibility: hidden;
		transition: all 0.3s;
	}
	.fa.visible {
		opacity: 1;
		visibility: visible;
	}
	.form-group input[type="text"] {
		width: 200px;
	}
</style>

<p class="form-group">
	<label for="address"><span data-i18n="pair.title"></span></label>

	<span class="input-wrap">
		<input type="text" id="school" placeholder="School" value="" />
	</span>
	<br>
	<span class="input-wrap">
		<input type="text" id="username" placeholder="112233" value="" />
	</span>
	<br>
	<span class="input-wrap">
		<input type="text" id="password" placeholder="Password" value="" />
	</span>
	<br>
	<br>


	<button class="button" id="validate">Connect</button>
	<i class="magister-status magister-loading fa fa-circle-o-notch fa-spin"></i>
	<i class="magister-status magister-ok fa fa-check" style="color: #96ff00;"></i>
	<i class="magister-status magister-err fa fa-times" style="color: #ff6300;"></i>

</p>
<p class="magister-err-msg" style="color: #ff6300;">
</p>

<script type="text/javascript">

$(function(){
	$('#validate').click(function(){

		var school = $('#school').val();
		var username = $('#username').val();
		var password = $('#password').val();

		$('.magister-status').removeClass('visible');
		$('.magister-loading').addClass('visible');

		Homey.emit('validate', {
			school: school,
			username: username,
			password: password
			}, function( err, result ){

			$('.magister-status').removeClass('visible');
			if(!err) {																// connection validation successful, start device pairing
				$('.magister-ok').addClass('visible');
				$('.magister-err-msg').html('');

				var device_data_init = {
					id: result.id+school, //change after testing multiple students
					magisterId: result.id
				};

				var settings_init = {
					student			: result,
					school			: result.magisterSchool.name,
					username		: username,
					password		: password,
					studentName	: result.fullName,
					period			: null,
					type_group	: null,
					totalAverageGrade: 0,
					notifyGradeChange: false,
					notifyRosterChange: false
				};

				Homey.addDevice({
					data	: device_data_init,
					name	: result.firstName,
					settings: settings_init
					}, function( err, result ){
						if( err ) {
							return Homey.alert(err.message || err.toString());
						} else {
							Homey.done()	}	// Close the pairing window
					})

				} else {			//connection validation unsuccessfull
					$('.magister-err').addClass('visible');
					$('.magister-err-msg').html( err.message || err.toString() );
				}
			})	//end of validate / pairing procedure

		});
	})

	</script>

	</script>
